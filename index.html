<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Annualised Hours & Leave Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
    }
    .container {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 800px;
      margin: auto;
    }
    h1, h2, h3 {
      color: #333;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input[type="number"] {
      width: 100%;
      padding: 8px;
      margin: 5px 0 15px;
      box-sizing: border-box;
    }
    .btn {
      padding: 10px 20px;
      background-color: #0077cc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
      margin-right: 10px;
    }
    .btn:hover {
      background-color: #005fa3;
    }
    .results, .comparator, .estimator, .workings, .explanation {
      background-color: #f9f9f9;
      border-left: 5px solid #0077cc;
      padding: 15px;
      margin-top: 20px;
    }
    .estimator {
      background-color: #fffbe6;
      border-left: 5px solid #f1c40f;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      text-align: left;
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }
    tr:nth-child(even) {background-color: #f2f2f2;}
    .note {
      font-size: 0.9em;
      color: #666;
    }
    .half-day {
      color: #777;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Annualised Hours & Leave Calculator</h1>
  <label for="weeklyHours">Current Weekly Hours</label>
  <input type="number" id="weeklyHours" step="0.1" value="37">
  <label for="workingWeeks">Working Weeks per Year</label>
  <input type="number" id="workingWeeks" step="0.1" value="52">
  <label><input type="checkbox" id="hasLongService"> I have 5+ years of service</label>
  <button class="btn" onclick="calculate()">Calculate</button>
  <button class="btn" onclick="downloadCSV()">Download CSV</button>

  <div id="results" class="results"></div>
  <div id="comparator" class="comparator"><h2>Comparison: Current vs Annualised Model</h2></div>
  <div id="leaveEstimator" class="estimator"></div>
  <div id="workings" class="workings"></div>
  <div id="explanation" class="explanation"></div>
</div>

<script>
let resultData = {};

function calculate() {
  const weeklyHours = parseFloat(document.getElementById('weeklyHours').value);
  const workingWeeks = parseFloat(document.getElementById('workingWeeks').value);
  const hasLongService = document.getElementById('hasLongService').checked;

  const FTE = (weeklyHours * workingWeeks) / 1924;
  const peakWeeks = 43;
  const peakHours = 40;
  const annualHours = (peakWeeks * peakHours + (workingWeeks - peakWeeks) * 22.67) * FTE;
  const leaveDays = hasLongService ? 25 : 20;
  const leaveHours = leaveDays * 8 * FTE;
  const leaveInDays = leaveHours / 8;
  const leaveInPeakWeeks = leaveHours / 40;
  const nonPeakHours = (annualHours - (peakWeeks * peakHours * FTE)) / (workingWeeks - peakWeeks);
  const leaveInNonPeakWeeks = leaveHours / nonPeakHours;

  resultData = {
    FTE,
    annualHours,
    leaveHours,
    leaveInDays,
    leaveInPeakWeeks,
    leaveInNonPeakWeeks,
    nonPeakHours
  };

  document.getElementById('results').innerHTML = `
    <h2>Annualised Hours Summary</h2>
    <table>
      <tr><td><strong>FTE (calculated)</strong></td><td>${FTE.toFixed(4)}</td></tr>
      <tr><td>Total Contracted Hours</td><td>${annualHours.toFixed(2)} hrs</td></tr>
      <tr><td>Annual Leave (pro-rata)</td><td>${leaveHours.toFixed(2)} hrs</td></tr>
      <tr><td>Equivalent to</td><td>${leaveInDays.toFixed(2)} days (8 hrs/day), ${leaveInPeakWeeks.toFixed(2)} peak weeks, or ${leaveInNonPeakWeeks.toFixed(2)} non-peak weeks</td></tr>
    </table>
  `;

  document.getElementById('leaveEstimator').innerHTML = `
    <h2>Leave Request Estimator</h2>
    <label for="daysRequested">Days of Leave Requested</label>
    <input type="number" id="daysRequested" step="0.1" value="1">
    <label><input type="radio" name="weekType" value="peak" checked> Applies to Peak Weeks</label>
    <label><input type="radio" name="weekType" value="nonpeak"> Applies to Non-Peak Weeks</label>
    <button class="btn" onclick="calculateLeaveImpact()">Estimate Leave Impact</button>
    <div id="leaveOutput"></div>
  `;

  document.getElementById('workings').innerHTML = `
    <h2>Workings (Pro-Rata Explained)</h2>
    <p><strong>Pro-rata</strong> means your entitlement is proportionate to how much you work compared to a full-time employee (1,924 hours/year).</p>
    <p>FTE = (Weekly Hours × Working Weeks) ÷ 1,924</p>
    <p>Leave = ${leaveDays} × 8 × FTE</p>
    <p>Annual Hours = (43 × 40 + (WorkingWeeks − 43) × 22.67) × FTE</p>
  `;

  document.getElementById('explanation').innerHTML = `
    <h2>Illustrative Daily Lengths:</h2>
    <p>Full day (Peak Week) = 8 hours<br><span class="half-day">Half day = 4 hours</span></p>
    <p>Full day (Non-Peak) = ${(nonPeakHours / 3).toFixed(2)} hours<br><span class="half-day">Half day = ${(nonPeakHours / 6).toFixed(2)} hours</span></p>
    <p class="note">Excludes 13 Closure Days and 8 Public Holidays, which are fixed and not deducted from your annual leave balance.</p>
  `;
}

function calculateLeaveImpact() {
  const days = parseFloat(document.getElementById('daysRequested').value);
  const weekType = document.querySelector('input[name="weekType"]:checked').value;
  const hoursPerDay = weekType === 'peak' ? 8 : resultData.nonPeakHours / 3;
  const hoursRequested = days * hoursPerDay;
  const leaveBefore = resultData.leaveHours;
  const leaveAfter = leaveBefore - hoursRequested;

  document.getElementById('leaveOutput').innerHTML = `
    <table>
      <tr><td>Hours Requested</td><td>${hoursRequested.toFixed(2)} hrs</td></tr>
      <tr><td>Leave Before Request</td><td>${leaveBefore.toFixed(2)} hrs</td></tr>
      <tr><td>Remaining Leave (hrs)</td><td>${leaveAfter.toFixed(2)} hrs</td></tr>
      <tr><td>Equivalent Remaining Leave</td><td>${(leaveAfter / 8).toFixed(2)} days (Peak) or ${(leaveAfter / (resultData.nonPeakHours / 3)).toFixed(2)} days (Non-Peak)</td></tr>
    </table>
  `;
}

function downloadCSV() {
  const csv = `FTE,Annual Hours,Leave Hours,Leave Days (8 hrs),Leave Peak Weeks,Leave Non-Peak Weeks\n` +
    `${resultData.FTE.toFixed(4)},${resultData.annualHours.toFixed(2)},${resultData.leaveHours.toFixed(2)},${resultData.leaveInDays.toFixed(2)},${resultData.leaveInPeakWeeks.toFixed(2)},${resultData.leaveInNonPeakWeeks.toFixed(2)}`;
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'annualised_hours_summary.csv';
  a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
